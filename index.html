<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Isu Globalisasi Dalam Budaya</title>
<style>
  body { font-family:'Poppins',sans-serif; background:#efe8dd; color:#2f2b27; margin:0; padding:20px;}
  .container { max-width:900px; margin:auto; }
  .topic { background:#fffdf9; border-radius:10px; padding:18px; margin-bottom:20px; border:1px solid #dfd2bf; }
  h2 { color:#3f352d; margin-bottom:8px; }
  p { line-height:1.6; margin-bottom:12px; }
  .comments { background:#f7f3ee; border-radius:8px; padding:12px; min-height:60px; max-height:300px; overflow-y:auto; margin-bottom:12px;}
  .comment-box { background:#fdf8f2; border-radius:8px; padding:12px; display:flex; flex-direction:column; gap:8px; }
  input, textarea { padding:10px; border-radius:6px; border:1px solid #c8bdb1; background:#fffdfb; width:100%; }
  button { align-self:flex-end; background:linear-gradient(90deg,#FFD54F,#FFC107); border:none; color:#2f2f2f; padding:8px 16px; border-radius:6px; cursor:pointer; font-weight:600; box-shadow:0 4px 12px rgba(255,197,60,0.18);}
  
  .single-comment { 
    background:#ffffff; 
    border-left:4px solid #d6b984; 
    border-radius:8px; 
    padding:10px 12px; 
    margin-bottom:10px; 
    box-shadow:0 1px 3px rgba(0,0,0,0.04);
    position: relative;
    padding-right: 35px;
  }
  .comment-name { color:#3b3028; font-weight:600; margin-bottom:4px;}
  .comment-time { color:#7a6f63; font-size:12px;}

  .delete-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #f0e9e0;
    border: 1px solid #dcd1c2;
    color: #8a7c6c;
    border-radius: 50%;
    width: 22px;
    height: 22px;
    cursor: pointer;
    font-weight: 600;
    line-height: 20px;
    padding: 0;
    font-size: 14px;
    text-align: center;
  }
  .delete-btn:hover {
    background: #e6dbcc;
    color: #333;
  }

  .emoji-bar {
    margin-top: 10px;
    padding-top: 8px;
    border-top: 1px solid #f0e9e0;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center; /* Tambah ini */
  }
  .emoji-btn {
    background: #f7f3ee;
    border: 1px solid #e6dbcc;
    border-radius: 10px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
  }
  .emoji-btn:hover {
    background: #e6dbcc;
    border-color: #d6b984;
  }
  .emoji-count {
    font-size: 12px;
    color: #3b3028;
    font-weight: 600;
    margin-left: 4px;
    min-width: 10px;
  }
  
  /* === INI STYLE BARU UNTUK BUTANG "BALAS" === */
  .reply-btn {
    background: none;
    border: none;
    color: #7a6f63;
    font-weight: 600;
    cursor: pointer;
    font-size: 13px;
    padding: 4px 8px;
    margin-left: auto; /* Letak di hujung kanan */
  }
  .reply-btn:hover {
    text-decoration: underline;
  }
  /* === TAMAT STYLE BARU === */
  
</style>
</head>
<body>
<div class="container">
  <h1 style="text-align:center;">üí¨ Isu Globalisasi Dalam Budaya</h1>
  <p style="text-align:center;">Baca perbincangan di bawah mengikut topik, kemudian tambah pendapat anda.</p>

  <div class="topic" id="topic1">
    <h2>üëó Pakaian Moden: Fesyen Ke atau Dah Lupa Aurat?</h2>
    <p>Sekarang semua nak nampak bergaya ‚Äî ikut tren, artis, dan influencer. Tapi dalam kejar fesyen moden, ramai dah lupa batas aurat dan kesopanan yang Islam ajar. Kita bangga ikut gaya Barat sebab nampak <i>‚Äútrendy‚Äù</i> dan <i>‚Äúup to date‚Äù</i>, tapi dalam masa sama maruah dan identiti Islam makin hilang.</p>
    <div id="comments-topic1" class="comments"></div>
    <div class="comment-box">
      <input id="name-topic1" placeholder="Nama (Wajib diisi)">
      <textarea id="input-topic1" rows="3" placeholder="Tulis pendapat anda..."></textarea>
      <button onclick="postComment('topic1')">Hantar</button>
    </div>
  </div>

  <div class="topic" id="topic2">
    <h2>üíç Perkahwinan Bebas Anak: Kebebasan Atau Hilang Arah?</h2>
    <p>Semakin ramai pasangan pilih kahwin tanpa anak. Katanya nak fokus kerjaya, nak <i>‚Äúenjoy hidup‚Äù</i>, atau takut anak jadi beban. Pemikiran ni datang dari budaya Barat yang utamakan kebebasan diri. Tapi dalam Islam, anak itu rezeki dan amanah. Bila kita tolak zuriat, kita tolak tanggungjawab yang Allah beri.</p>
    <div id="comments-topic2" class="comments"></div>
    <div class="comment-box">
      <input id="name-topic2" placeholder="Nama (Wajib diisi)">
      <textarea id="input-topic2" rows="3" placeholder="Tulis pendapat anda..."></textarea>
      <button onclick="postComment('topic2')">Hantar</button>
    </div>
  </div>

  <div class="topic" id="topic3">
    <h2>üë´ Pergaulan Bebas: Dah Biasa Sebab Dunia Dah Terbuka?</h2>
    <p><i>‚ÄúKawan je pun.‚Äù</i> ‚Äî ayat paling biasa bila sebut pergaulan bebas. Tapi bila batas makin kabur, dosa jadi hal kecil. Budaya Barat buat semua tu nampak normal, padahal Islam dah tetapkan batas untuk jaga maruah. Dunia boleh terbuka, tapi jangan sampai prinsip Islam kita terbuka sama.</p>
    <div id="comments-topic3" class="comments"></div>
    <div class="comment-box">
      <input id="name-topic3" placeholder="Nama (Wajib diisi)">
      <textarea id="input-topic3" rows="3" placeholder="Tulis pendapat anda..."></textarea>
      <button onclick="postComment('topic3')">Hantar</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-database-compat.js"></script>
<script>
// !!!!! GANTI DI SINI !!!!!
// GANTIKAN SEMUA DI BAWAH DENGAN FIREBASE CONFIG AWAK YANG ASAL
const firebaseConfig = {
  apiKey: "AIzaSy... (GANTI INI)",
  authDomain: "isu-globalisasi... (GANTI INI)",
  databaseURL: "https://isu-globalisasi-budaya-comment-default-rtdb.asia-southeast1.firebasedatabase.app", // (GANTI INI)
  projectId: "isu-globalisasi... (GANTI INI)",
  storageBucket: "isu-globalisasi... (GANTI INI)",
  messagingSenderId: "884609... (GANTI INI)",
  appId: "1:884609... (GANTI INI)"
};
// !!!!!!!!!!!!!!!!!!!!!!!!!

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ALLOWED_EMOJIS = ['üëç', '‚ù§Ô∏è', 'üòÇ', 'üòÆ'];

function escapeHtml(unsafe){
  return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;")
               .replace(/>/g,"&gt;").replace(/"/g,"&quot;")
               .replace(/'/g,"&#039;");
}

// ===== FUNGSI DIKEMAS KINI (tambah butang Balas) =====
function makeCommentElement(topicId, commentId, data){
  const div = document.createElement('div');
  div.className = 'single-comment';
  const date = new Date(data.time);
  const timeStr = date.toLocaleString('ms-MY',{year:'numeric',month:'short',day:'numeric',hour:'numeric',minute:'2-digit'});
  
  let emojiBarHtml = '<div class="emoji-bar">';
  const reactions = data.reactions || {}; 
  
  for (const emoji of ALLOWED_EMOJIS) {
    const count = reactions[emoji] || 0; 
    emojiBarHtml += `
      <button class="emoji-btn" onclick="addReaction('${topicId}', '${commentId}', '${emoji}')">
        ${emoji} <span class="emoji-count">${count}</span>
      </button>
    `;
  }
  
  // === INI KOD BARU UNTUK "BALAS" ===
  // Sediakan nama yang 'safe' untuk diletak dalam onclick
  const safeName = data.name.replace(/'/g, "\\'"); // Escape single quotes
  emojiBarHtml += `
    <button class="reply-btn" onclick="replyTo('${topicId}', '${safeName}')">
      Balas
    </button>
  `;
  // === TAMAT KOD BARU ===
  
  emojiBarHtml += '</div>';

  div.innerHTML = `
    <button class="delete-btn" onclick="deleteComment('${topicId}', '${commentId}')">X</button>
    <div class="comment-name">${escapeHtml(data.name)}</div>
    <div>${escapeHtml(data.text)}</div>
    <div class="comment-time">${timeStr}</div>
    ${emojiBarHtml} 
  `; 
  return div;
}

// ===== FUNGSI DIKEMAS KINI (NAMA WAJIB DIISI) =====
function postComment(topicId){
  const nameInput = document.getElementById(`name-${topicId}`);
  const input = document.getElementById(`input-${topicId}`);
  
  const name = nameInput.value.trim(); // Dapatkan nama
  const text = input.value.trim();
  
  // --- KEMAS KINI DI SINI ---
  // Periksa jika teks atau nama kosong
  if(!text){ 
    alert('Sila tulis komen dahulu.'); 
    return; 
  }
  if(!name){ 
    alert('Sila masukkan nama anda untuk hantar komen.'); 
    return; 
  }
  // --- TAMAT KEMAS KINI ---
  
  db.ref('comments/'+topicId).push({name,text,time:Date.now()});
  
  input.value=''; nameInput.value='';
}

function loadComments(topicId){
  const container = document.getElementById('comments-'+topicId);
  db.ref('comments/'+topicId).on('value', snapshot=>{
    container.innerHTML='';
    const data = snapshot.val();
    if(data){
      Object.entries(data)
        .sort((a, b) => b[1].time - a[1].time) 
        .forEach(([commentId, commentData]) => {
          container.appendChild(makeCommentElement(topicId, commentId, commentData));
        });
    }
  });
}

function deleteComment(topicId, commentId) {
  if (confirm('Anda pasti nak padam komen ini?')) {
    db.ref(`comments/${topicId}/${commentId}`)
      .remove()
      .catch(err => {
        alert('Gagal padam komen: '.concat(err.message));
      });
  }
}

function addReaction(topicId, commentId, emoji) {
  const reactionRef = db.ref(`comments/${topicId}/${commentId}/reactions/${emoji}`);
  
  reactionRef.transaction(currentValue => {
    return (currentValue || 0) + 1;
  });
}

// ===== FUNGSI BARU (UNTUK SIMULASI REPLY) =====
function replyTo(topicId, name) {
  const input = document.getElementById(`input-${topicId}`);
  
  // Letak @Nama di kotak komen
  input.value = `@${name} `;
  
  // Terus fokus ke kotak komen
  input.focus();
}
// ===========================================

['topic1','topic2','topic3'].forEach(loadComments);
</script>
</body>
</html>

